<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="4180px" preserveAspectRatio="none" style="width:823px;height:4180px;" version="1.1" viewBox="0 0 823 4180" width="823px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="38.1016" rx="5" ry="5" style="stroke: #000000; stroke-width: 1.0;" width="509" x="155.5" y="12"/><text fill="#000000" font-family="Consolas" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="493" x="163.5" y="38.9258">WebRTC设置loacal SDP与收集设置candidate</text><ellipse cx="306" cy="63.1016" fill="#000000" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FFFFFF" height="2414.9219" style="stroke: #BAC0C1; stroke-width: 2.0;" width="801" x="11" y="83.1016"/><path d="M272,83.1016 L272,94.8359 L262,104.8359 L11,104.8359 " fill="none" style="stroke: #BAC0C1; stroke-width: 2.0;"/><text fill="#555555" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="251" x="14" y="98.7188">设置loacal_SDP与收集candidate</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="370" x="121" y="121.8359"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="350" x="131" y="148.2803">PeerConnection::SetLocalDescription</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="460" x="76" y="182.9121"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="440" x="86" y="209.3564">JsepTransportController::MaybeStartGathering</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="420" x="96" y="272.7227"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="400" x="106" y="299.167">P2PTransportChannel::MaybeStartGathering</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="450" x="81" y="381.2676"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="430" x="91" y="407.7119">BasicPortAllocatorSession::StartGettingPort</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="500" x="56" y="471.0781"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="480" x="66" y="497.5225">BasicPortAllocatorSession::GetPortConfigurations</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="420" x="96" y="532.1543"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="400" x="106" y="558.5986">BasicPortAllocatorSession::OnConfigReady</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="390" x="111" y="593.2305"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="370" x="121" y="619.6748">BasicPortAllocatorSession::OnAllocate</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="390" x="111" y="654.3066"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="370" x="121" y="680.751">BasicPortAllocatorSession::DoAllocate</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="270" x="171" y="715.3828"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="250" x="181" y="741.8271">AllocationSequence::Start</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="380" x="116" y="805.1934"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="360" x="126" y="831.6377">AllocationSequence::CreateRelayPorts</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="370" x="121" y="866.2695"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="350" x="131" y="892.7139">AllocationSequence::CreateGturnPort</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="450" x="81" y="927.3457"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="430" x="91" y="953.79">BasicPortAllocatorSession::AddAllocatedPort</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="260" x="176" y="1054.625"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="240" x="186" y="1081.0693">TurnPort::PrepareAddress</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="230" x="191" y="1115.7012"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="210" x="201" y="1142.1455">TurnPort::SendRequest</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="240" x="186" y="1205.5117"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="220" x="196" y="1231.9561">StunRequest::OnMessage</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="350" x="131" y="1295.3223"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="330" x="141" y="1321.7666">StunRequestManager::CheckResponse</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="380" x="116" y="1356.3984"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="360" x="126" y="1382.8428">TurnAllocateRequest::OnErrorResponse</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="380" x="116" y="1446.209"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="360" x="126" y="1472.6533">TurnAllocateRequest::OnAuthChallenge</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="230" x="191" y="1507.2852"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="210" x="201" y="1533.7295">TurnPort::SendRequest</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="350" x="131" y="1597.0957"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="330" x="141" y="1623.54">StunRequestManager::CheckResponse</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="320" x="146" y="1658.1719"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="300" x="156" y="1684.6162">TurnRefreshRequest::OnResponse</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="290" x="161" y="1719.248"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="270" x="171" y="1745.6924">TurnPort::OnAllocateSuccess</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="170" x="221" y="1780.3242"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="150" x="231" y="1806.7686">Port::AddAdress</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="270" x="171" y="1841.4004"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="250" x="181" y="1867.8447">Port::FinishAddingAddress</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="220" x="196" y="1902.4766"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="200" x="206" y="1928.9209">Port::PostAddAddress</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="450" x="81" y="1992.2871"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="430" x="91" y="2018.7314">BasicPortAllocatorSession::OnCandidateReady</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="400" x="106" y="2082.0977"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="380" x="116" y="2108.542">P2PTransportChannel::OnCandidatesReady</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="570" x="21" y="2171.9082"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="550" x="31" y="2198.3525">JsepTransportController::OnTransportCandidateGathered_n</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="570" x="21" y="2261.7188"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="550" x="31" y="2288.1631">PeerConnection::OnTransportControllerCandidatesGathered</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="320" x="146" y="2322.7949"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="300" x="156" y="2349.2393">PeerConnection::OnIceCandidate</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="390" x="111" y="2383.8711"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="370" x="121" y="2410.3154">PeerConnectionOberver::OnIceCandidate</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="470" x="71" y="2444.9473"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="450" x="81" y="2471.3916">PeerConnectionDelegateAdapter::OnIceCandidate</text><ellipse cx="306" cy="2528.0234" fill="#FFFFFF" rx="10" ry="10" style="stroke: #66696B; stroke-width: 2.0;"/><path d="M310.1582,2528.9014 L306.7041,2528.9014 L306.7041,2532.4873 L305.1924,2532.4873 L305.1924,2528.9014 L301.7383,2528.9014 L301.7383,2527.5654 L305.1924,2527.5654 L305.1924,2524.0059 L306.7041,2524.0059 L306.7041,2527.5654 L310.1582,2527.5654 Z "/><rect fill="#FFFFFF" height="1579.1582" style="stroke: #BAC0C1; stroke-width: 2.0;" width="540" x="36" y="2548.0234"/><path d="M207,2548.0234 L207,2559.7578 L197,2569.7578 L36,2569.7578 " fill="none" style="stroke: #BAC0C1; stroke-width: 2.0;"/><text fill="#555555" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="161" x="39" y="2563.6406">收到远端candidate后</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="360" x="126" y="2586.7578"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="340" x="136" y="2613.2021">RTCPeerConnection::addIceCandidate</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="410" x="101" y="2647.834"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="390" x="111" y="2674.2783">webrtc::PeerConnection::AddIceCandidate</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="300" x="156" y="2708.9102"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="280" x="166" y="2735.3545">PeerConnection::UseCandidate</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="460" x="76" y="2769.9863"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="440" x="86" y="2796.4307">JsepTransportController::AddRemoteCandidates</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="360" x="126" y="2831.0625"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="340" x="136" y="2857.5068">JsepTransport::AddRemoteCandidates</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="410" x="101" y="2920.873"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="390" x="111" y="2947.3174">P2PTransportChannel::AddRemoteCandidate</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="500" x="56" y="2981.9492"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="480" x="66" y="3008.3936">P2PTransportChannel::FinishAddingRemoteCandidate</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="400" x="106" y="3043.0254"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="380" x="116" y="3069.4697">P2PTransportChannel::CreateConnections</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="520" x="46" y="3104.1016"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="500" x="56" y="3130.5459">P2PTransportChannel::sortConnectionsAndUpdateState</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="400" x="106" y="3165.1777"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="380" x="116" y="3191.6221">P2PTransportChannel::MaybeStartPinging</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="350" x="131" y="3226.2539"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="330" x="141" y="3252.6982">P2PTransportChannel::CheckAndPing</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="370" x="121" y="3287.3301"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="350" x="131" y="3313.7744">P2PTransportChannel::PingConnection</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="330" x="141" y="3348.4063"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="310" x="151" y="3374.8506">StunRequestManager::SendDelayed</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="410" x="101" y="3438.2168"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="390" x="111" y="3464.6611">Connection::OnConnectionRequestResponse</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="340" x="136" y="3499.293"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="320" x="146" y="3525.7373">Connection::ReceivedPingResponse</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="290" x="161" y="3560.3691"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="270" x="171" y="3586.8135">Connection::set_write_state</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="460" x="76" y="3650.1797"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="440" x="86" y="3676.624">P2PTransportChannel::OnConnectionStateChange</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="480" x="66" y="3711.2559"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="460" x="76" y="3737.7002">P2PTransportChannel::RequestSortAndStateUpdate</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="520" x="46" y="3772.332"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="500" x="56" y="3798.7764">P2PTransportChannel::SortConnectionsAndUpdateState</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="470" x="71" y="3833.4082"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="450" x="81" y="3859.8525">P2PTransportChannel::SwitchSelectedConnection</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="300" x="156" y="3923.2188"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="280" x="166" y="3949.6631">DtlsTransport::OnReadyToSend</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="290" x="161" y="4013.0293"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="270" x="171" y="4039.4736">RTPTransport::OnReadyToSend</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="300" x="156" y="4074.1055"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="280" x="166" y="4100.5498">RtpTransport::SetReadyToSend</text><ellipse cx="306" cy="4158.1816" fill="#FFFFFF" rx="11" ry="11" style="stroke: #FF0000; stroke-width: 1.0;"/><ellipse cx="306" cy="4158.1816" fill="#FF0000" rx="6" ry="6" style="stroke: #FF7F7F; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="162.9121" y2="182.9121"/><polygon fill="#66696B" points="302,172.9121,306,182.9121,310,172.9121,306,176.9121" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="223.9883" y2="272.7227"/><polygon fill="#66696B" points="302,262.7227,306,272.7227,310,262.7227,306,266.7227" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="198" x="310" y="251.2227">&lt;IceTransportInternal&gt;</text><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="313.7988" y2="381.2676"/><polygon fill="#66696B" points="302,371.2676,306,381.2676,310,371.2676,306,375.2676" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="492" x="310" y="341.0332">PeerConnectionFactory::CreatePeerConnection初始化传入的,</text><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="369" x="310" y="359.7676">BasicPortAllocator::CreateSessionInternal</text><line style="stroke: #66696B; stroke-width: 1.5; stroke-dasharray: 7.0,7.0;" x1="306" x2="306" y1="422.3438" y2="471.0781"/><polygon fill="#66696B" points="302,461.0781,306,471.0781,310,461.0781,306,465.0781" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="99" x="310" y="449.5781">OnMessage()</text><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="512.1543" y2="532.1543"/><polygon fill="#66696B" points="302,522.1543,306,532.1543,310,522.1543,306,526.1543" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="573.2305" y2="593.2305"/><polygon fill="#66696B" points="302,583.2305,306,593.2305,310,583.2305,306,587.2305" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="634.3066" y2="654.3066"/><polygon fill="#66696B" points="302,644.3066,306,654.3066,310,644.3066,306,648.3066" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="695.3828" y2="715.3828"/><polygon fill="#66696B" points="302,705.3828,306,715.3828,310,705.3828,306,709.3828" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5; stroke-dasharray: 7.0,7.0;" x1="306" x2="306" y1="756.459" y2="805.1934"/><polygon fill="#66696B" points="302,795.1934,306,805.1934,310,795.1934,306,799.1934" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="99" x="310" y="783.6934">OnMessage()</text><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="846.2695" y2="866.2695"/><polygon fill="#66696B" points="302,856.2695,306,866.2695,310,856.2695,306,860.2695" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="907.3457" y2="927.3457"/><polygon fill="#66696B" points="302,917.3457,306,927.3457,310,917.3457,306,921.3457" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="968.4219" y2="1054.625"/><polygon fill="#66696B" points="302,1044.625,306,1054.625,310,1044.625,306,1048.625" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="36" x="310" y="995.6563">Port</text><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="324" x="310" y="1014.3906">&lt;PortInterface, rtc::MessageHandler,</text><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="189" x="310" y="1033.125">sigslot::has_slots&lt;&gt;&gt;</text><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="1095.7012" y2="1115.7012"/><polygon fill="#66696B" points="302,1105.7012,306,1115.7012,310,1105.7012,306,1109.7012" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5; stroke-dasharray: 7.0,7.0;" x1="306" x2="306" y1="1156.7773" y2="1205.5117"/><polygon fill="#66696B" points="302,1195.5117,306,1205.5117,310,1195.5117,306,1199.5117" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="279" x="310" y="1184.0117">StunRequestManager::SendDelayed</text><line style="stroke: #66696B; stroke-width: 1.5; stroke-dasharray: 1.0,3.0;" x1="306" x2="306" y1="1246.5879" y2="1295.3223"/><polygon fill="#66696B" points="302,1285.3223,306,1295.3223,310,1285.3223,306,1289.3223" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="144" x="310" y="1273.8223">发送请求，接收响应</text><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="1336.3984" y2="1356.3984"/><polygon fill="#66696B" points="302,1346.3984,306,1356.3984,310,1346.3984,306,1350.3984" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="1397.4746" y2="1446.209"/><polygon fill="#66696B" points="302,1436.209,306,1446.209,310,1436.209,306,1440.209" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="216" x="310" y="1424.709">STUN_ERROR_TRY_ALTERNATE</text><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="1487.2852" y2="1507.2852"/><polygon fill="#66696B" points="302,1497.2852,306,1507.2852,310,1497.2852,306,1501.2852" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5; stroke-dasharray: 1.0,3.0;" x1="306" x2="306" y1="1548.3613" y2="1597.0957"/><polygon fill="#66696B" points="302,1587.0957,306,1597.0957,310,1587.0957,306,1591.0957" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="144" x="310" y="1575.5957">发送请求，接收响应</text><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="1638.1719" y2="1658.1719"/><polygon fill="#66696B" points="302,1648.1719,306,1658.1719,310,1648.1719,306,1652.1719" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="1699.248" y2="1719.248"/><polygon fill="#66696B" points="302,1709.248,306,1719.248,310,1709.248,306,1713.248" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="1760.3242" y2="1780.3242"/><polygon fill="#66696B" points="302,1770.3242,306,1780.3242,310,1770.3242,306,1774.3242" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="1821.4004" y2="1841.4004"/><polygon fill="#66696B" points="302,1831.4004,306,1841.4004,310,1831.4004,306,1835.4004" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="1882.4766" y2="1902.4766"/><polygon fill="#66696B" points="302,1892.4766,306,1902.4766,310,1892.4766,306,1896.4766" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5; stroke-dasharray: 7.0,7.0;" x1="306" x2="306" y1="1943.5527" y2="1992.2871"/><polygon fill="#66696B" points="302,1982.2871,306,1992.2871,310,1982.2871,306,1986.2871" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="243" x="310" y="1970.7871">(sigslot)SignalPortComplete</text><line style="stroke: #66696B; stroke-width: 1.5; stroke-dasharray: 7.0,7.0;" x1="306" x2="306" y1="2033.3633" y2="2082.0977"/><polygon fill="#66696B" points="302,2072.0977,306,2082.0977,310,2072.0977,306,2076.0977" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="270" x="310" y="2060.5977">(sigslot)SignalCandidatesReady</text><line style="stroke: #66696B; stroke-width: 1.5; stroke-dasharray: 7.0,7.0;" x1="306" x2="306" y1="2123.1738" y2="2171.9082"/><polygon fill="#66696B" points="302,2161.9082,306,2171.9082,310,2161.9082,306,2165.9082" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="288" x="310" y="2150.4082">(sigslot)SignalCandidateGathered</text><line style="stroke: #66696B; stroke-width: 1.5; stroke-dasharray: 7.0,7.0;" x1="306" x2="306" y1="2212.9844" y2="2261.7188"/><polygon fill="#66696B" points="302,2251.7188,306,2261.7188,310,2251.7188,306,2255.7188" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="324" x="310" y="2240.2188">(sigslot)SignalIceCandidatesGathered</text><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="2302.7949" y2="2322.7949"/><polygon fill="#66696B" points="302,2312.7949,306,2322.7949,310,2312.7949,306,2316.7949" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="2363.8711" y2="2383.8711"/><polygon fill="#66696B" points="302,2373.8711,306,2383.8711,310,2373.8711,306,2377.8711" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="2424.9473" y2="2444.9473"/><polygon fill="#66696B" points="302,2434.9473,306,2444.9473,310,2434.9473,306,2438.9473" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="73.1016" y2="121.8359"/><polygon fill="#66696B" points="302,111.8359,306,121.8359,310,111.8359,306,115.8359" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="2486.0234" y2="2518.0234"/><polygon fill="#66696B" points="302,2508.0234,306,2518.0234,310,2508.0234,306,2512.0234" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="2627.834" y2="2647.834"/><polygon fill="#66696B" points="302,2637.834,306,2647.834,310,2637.834,306,2641.834" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="2688.9102" y2="2708.9102"/><polygon fill="#66696B" points="302,2698.9102,306,2708.9102,310,2698.9102,306,2702.9102" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="2749.9863" y2="2769.9863"/><polygon fill="#66696B" points="302,2759.9863,306,2769.9863,310,2759.9863,306,2763.9863" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="2811.0625" y2="2831.0625"/><polygon fill="#66696B" points="302,2821.0625,306,2831.0625,310,2821.0625,306,2825.0625" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="2872.1387" y2="2920.873"/><polygon fill="#66696B" points="302,2910.873,306,2920.873,310,2910.873,306,2914.873" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="198" x="310" y="2899.373">&lt;IceTransportInternal&gt;</text><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="2961.9492" y2="2981.9492"/><polygon fill="#66696B" points="302,2971.9492,306,2981.9492,310,2971.9492,306,2975.9492" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="3023.0254" y2="3043.0254"/><polygon fill="#66696B" points="302,3033.0254,306,3043.0254,310,3033.0254,306,3037.0254" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="3084.1016" y2="3104.1016"/><polygon fill="#66696B" points="302,3094.1016,306,3104.1016,310,3094.1016,306,3098.1016" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="3145.1777" y2="3165.1777"/><polygon fill="#66696B" points="302,3155.1777,306,3165.1777,310,3155.1777,306,3159.1777" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="3206.2539" y2="3226.2539"/><polygon fill="#66696B" points="302,3216.2539,306,3226.2539,310,3216.2539,306,3220.2539" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="3267.3301" y2="3287.3301"/><polygon fill="#66696B" points="302,3277.3301,306,3287.3301,310,3277.3301,306,3281.3301" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="3328.4063" y2="3348.4063"/><polygon fill="#66696B" points="302,3338.4063,306,3348.4063,310,3338.4063,306,3342.4063" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5; stroke-dasharray: 1.0,3.0;" x1="306" x2="306" y1="3389.4824" y2="3438.2168"/><polygon fill="#66696B" points="302,3428.2168,306,3438.2168,310,3428.2168,306,3432.2168" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="144" x="310" y="3416.7168">发送请求，接收消息</text><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="3479.293" y2="3499.293"/><polygon fill="#66696B" points="302,3489.293,306,3499.293,310,3489.293,306,3493.293" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="3540.3691" y2="3560.3691"/><polygon fill="#66696B" points="302,3550.3691,306,3560.3691,310,3550.3691,306,3554.3691" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5; stroke-dasharray: 7.0,7.0;" x1="306" x2="306" y1="3601.4453" y2="3650.1797"/><polygon fill="#66696B" points="302,3640.1797,306,3650.1797,310,3640.1797,306,3644.1797" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="234" x="310" y="3628.6797">(sigslot)SignalStateChange</text><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="3691.2559" y2="3711.2559"/><polygon fill="#66696B" points="302,3701.2559,306,3711.2559,310,3701.2559,306,3705.2559" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="3752.332" y2="3772.332"/><polygon fill="#66696B" points="302,3762.332,306,3772.332,310,3762.332,306,3766.332" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="3813.4082" y2="3833.4082"/><polygon fill="#66696B" points="302,3823.4082,306,3833.4082,310,3823.4082,306,3827.4082" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5; stroke-dasharray: 7.0,7.0;" x1="306" x2="306" y1="3874.4844" y2="3923.2188"/><polygon fill="#66696B" points="302,3913.2188,306,3923.2188,310,3913.2188,306,3917.2188" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="234" x="310" y="3901.7188">(sigslot)SignalReadyToSend</text><line style="stroke: #66696B; stroke-width: 1.5; stroke-dasharray: 7.0,7.0;" x1="306" x2="306" y1="3964.2949" y2="4013.0293"/><polygon fill="#66696B" points="302,4003.0293,306,4013.0293,310,4003.0293,306,4007.0293" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="234" x="310" y="3991.5293">(sigslot)SignalReadyToSend</text><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="4054.1055" y2="4074.1055"/><polygon fill="#66696B" points="302,4064.1055,306,4074.1055,310,4064.1055,306,4068.1055" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="2538.0234" y2="2586.7578"/><polygon fill="#66696B" points="302,2576.7578,306,2586.7578,310,2576.7578,306,2580.7578" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="306" x2="306" y1="4115.1816" y2="4147.1816"/><polygon fill="#66696B" points="302,4137.1816,306,4147.1816,310,4137.1816,306,4141.1816" style="stroke: #66696B; stroke-width: 1.0;"/><!--MD5=[961a3b00e518cd1ebab4d6e6675f17ea]
@startuml

' https://plantuml-documentation.readthedocs.io/en/latest/formatting/all-skin-params.html

' skinparam monochrome true
' skinparam backgroundColor transparent
' skinparam handwritten true
'/'
skinparam DefaultFontName Consolas
' skinparam DefaultTextAlignment center
skinparam DefaultFontSize 16
skinparam shadowing false

skinparam Activity {
    StartColor black
    EndColor red
    ArrowColor #66696b
    BorderColor #66696b

    BackgroundColor #FFFFFF
    BorderThickness 2
    FontName Consolas
    FontSize 18
    ' FontStyle bold
}

skinparam Note {
    BorderColor #66696b
    BackgroundColor #FFFFFF
    FontName Consolas
    FontSize 16
    FontColor #555555
    ' BorderThickness 4
}

skinparam Partition {
    BorderColor #bac0c1
    FontColor #555555
}

skinparam title {
   FontSize 24
   BorderRoundCorner 10
   BorderThickness 1
   ' BorderColor red
   ' BackgroundColor Aqua-CadetBlue
}
'/

title WebRTC设置loacal SDP与收集设置candidate

start

partition 设置loacal_SDP与收集candidate {

:PeerConnection::SetLocalDescription]

:JsepTransportController::MaybeStartGathering]

-><IceTransportInternal>;

:P2PTransportChannel::MaybeStartGathering]

->PeerConnectionFactory::CreatePeerConnection初始化传入的,
BasicPortAllocator::CreateSessionInternal;

:BasicPortAllocatorSession::StartGettingPort]

-[dashed]->OnMessage();

:BasicPortAllocatorSession::GetPortConfigurations]

:BasicPortAllocatorSession::OnConfigReady]

:BasicPortAllocatorSession::OnAllocate]

:BasicPortAllocatorSession::DoAllocate]

:AllocationSequence::Start]

-[dashed]->OnMessage();

:AllocationSequence::CreateRelayPorts]

:AllocationSequence::CreateGturnPort]

:BasicPortAllocatorSession::AddAllocatedPort]

->Port
<PortInterface, rtc::MessageHandler, 
sigslot::has_slots<>>;

:TurnPort::PrepareAddress]

:TurnPort::SendRequest]

-[dashed]->StunRequestManager::SendDelayed;

:StunRequest::OnMessage]

-[dotted]->发送请求，接收响应;

:StunRequestManager::CheckResponse]

:TurnAllocateRequest::OnErrorResponse]

->STUN_ERROR_TRY_ALTERNATE;

:TurnAllocateRequest::OnAuthChallenge]

:TurnPort::SendRequest]

-[dotted]->发送请求，接收响应;

:StunRequestManager::CheckResponse]

:TurnRefreshRequest::OnResponse]

:TurnPort::OnAllocateSuccess]

:Port::AddAdress]

:Port::FinishAddingAddress]

:Port::PostAddAddress]

-[dashed]->(sigslot)SignalPortComplete;

:BasicPortAllocatorSession::OnCandidateReady]

-[dashed]->(sigslot)SignalCandidatesReady;

:P2PTransportChannel::OnCandidatesReady]

-[dashed]->(sigslot)SignalCandidateGathered;

:JsepTransportController::OnTransportCandidateGathered_n]

-[dashed]->(sigslot)SignalIceCandidatesGathered;

:PeerConnection::OnTransportControllerCandidatesGathered]

:PeerConnection::OnIceCandidate]

:PeerConnectionOberver::OnIceCandidate]

:PeerConnectionDelegateAdapter::OnIceCandidate]

}

(+)

partition 收到远端candidate后 {

:RTCPeerConnection::addIceCandidate]

:webrtc::PeerConnection::AddIceCandidate]

:PeerConnection::UseCandidate]

:JsepTransportController::AddRemoteCandidates]

:JsepTransport::AddRemoteCandidates]

-><IceTransportInternal>;

:P2PTransportChannel::AddRemoteCandidate]

:P2PTransportChannel::FinishAddingRemoteCandidate]

:P2PTransportChannel::CreateConnections]

:P2PTransportChannel::sortConnectionsAndUpdateState]

:P2PTransportChannel::MaybeStartPinging]

:P2PTransportChannel::CheckAndPing]

:P2PTransportChannel::PingConnection]

:StunRequestManager::SendDelayed]

-[dotted]->发送请求，接收消息;

:Connection::OnConnectionRequestResponse]

:Connection::ReceivedPingResponse]

:Connection::set_write_state]

-[dashed]->(sigslot)SignalStateChange;

:P2PTransportChannel::OnConnectionStateChange]

:P2PTransportChannel::RequestSortAndStateUpdate]

:P2PTransportChannel::SortConnectionsAndUpdateState]

:P2PTransportChannel::SwitchSelectedConnection]

-[dashed]->(sigslot)SignalReadyToSend;

:DtlsTransport::OnReadyToSend]

-[dashed]->(sigslot)SignalReadyToSend;

:RTPTransport::OnReadyToSend]

:RtpTransport::SetReadyToSend]

}

stop

 
@enduml

@startuml


skinparam DefaultFontName Consolas
skinparam DefaultFontSize 16
skinparam shadowing false

skinparam Activity {
    StartColor black
    EndColor red
    ArrowColor #66696b
    BorderColor #66696b

    BackgroundColor #FFFFFF
    BorderThickness 2
    FontName Consolas
    FontSize 18
}

skinparam Note {
    BorderColor #66696b
    BackgroundColor #FFFFFF
    FontName Consolas
    FontSize 16
    FontColor #555555
}

skinparam Partition {
    BorderColor #bac0c1
    FontColor #555555
}

skinparam title {
   FontSize 24
   BorderRoundCorner 10
   BorderThickness 1
}

title WebRTC设置loacal SDP与收集设置candidate

start

partition 设置loacal_SDP与收集candidate {

:PeerConnection::SetLocalDescription]

:JsepTransportController::MaybeStartGathering]

-><IceTransportInternal>;

:P2PTransportChannel::MaybeStartGathering]

->PeerConnectionFactory::CreatePeerConnection初始化传入的,
BasicPortAllocator::CreateSessionInternal;

:BasicPortAllocatorSession::StartGettingPort]

-[dashed]->OnMessage();

:BasicPortAllocatorSession::GetPortConfigurations]

:BasicPortAllocatorSession::OnConfigReady]

:BasicPortAllocatorSession::OnAllocate]

:BasicPortAllocatorSession::DoAllocate]

:AllocationSequence::Start]

-[dashed]->OnMessage();

:AllocationSequence::CreateRelayPorts]

:AllocationSequence::CreateGturnPort]

:BasicPortAllocatorSession::AddAllocatedPort]

->Port
<PortInterface, rtc::MessageHandler, 
sigslot::has_slots<>>;

:TurnPort::PrepareAddress]

:TurnPort::SendRequest]

-[dashed]->StunRequestManager::SendDelayed;

:StunRequest::OnMessage]

-[dotted]->发送请求，接收响应;

:StunRequestManager::CheckResponse]

:TurnAllocateRequest::OnErrorResponse]

->STUN_ERROR_TRY_ALTERNATE;

:TurnAllocateRequest::OnAuthChallenge]

:TurnPort::SendRequest]

-[dotted]->发送请求，接收响应;

:StunRequestManager::CheckResponse]

:TurnRefreshRequest::OnResponse]

:TurnPort::OnAllocateSuccess]

:Port::AddAdress]

:Port::FinishAddingAddress]

:Port::PostAddAddress]

-[dashed]->(sigslot)SignalPortComplete;

:BasicPortAllocatorSession::OnCandidateReady]

-[dashed]->(sigslot)SignalCandidatesReady;

:P2PTransportChannel::OnCandidatesReady]

-[dashed]->(sigslot)SignalCandidateGathered;

:JsepTransportController::OnTransportCandidateGathered_n]

-[dashed]->(sigslot)SignalIceCandidatesGathered;

:PeerConnection::OnTransportControllerCandidatesGathered]

:PeerConnection::OnIceCandidate]

:PeerConnectionOberver::OnIceCandidate]

:PeerConnectionDelegateAdapter::OnIceCandidate]

}

(+)

partition 收到远端candidate后 {

:RTCPeerConnection::addIceCandidate]

:webrtc::PeerConnection::AddIceCandidate]

:PeerConnection::UseCandidate]

:JsepTransportController::AddRemoteCandidates]

:JsepTransport::AddRemoteCandidates]

-><IceTransportInternal>;

:P2PTransportChannel::AddRemoteCandidate]

:P2PTransportChannel::FinishAddingRemoteCandidate]

:P2PTransportChannel::CreateConnections]

:P2PTransportChannel::sortConnectionsAndUpdateState]

:P2PTransportChannel::MaybeStartPinging]

:P2PTransportChannel::CheckAndPing]

:P2PTransportChannel::PingConnection]

:StunRequestManager::SendDelayed]

-[dotted]->发送请求，接收消息;

:Connection::OnConnectionRequestResponse]

:Connection::ReceivedPingResponse]

:Connection::set_write_state]

-[dashed]->(sigslot)SignalStateChange;

:P2PTransportChannel::OnConnectionStateChange]

:P2PTransportChannel::RequestSortAndStateUpdate]

:P2PTransportChannel::SortConnectionsAndUpdateState]

:P2PTransportChannel::SwitchSelectedConnection]

-[dashed]->(sigslot)SignalReadyToSend;

:DtlsTransport::OnReadyToSend]

-[dashed]->(sigslot)SignalReadyToSend;

:RTPTransport::OnReadyToSend]

:RtpTransport::SetReadyToSend]

}

stop

 
@enduml

PlantUML version 1.2020.18(Thu Oct 01 03:40:44 CST 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg>