<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1799px" preserveAspectRatio="none" style="width:532px;height:1799px;" version="1.1" viewBox="0 0 532 1799" width="532px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="38.1016" rx="5" ry="5" style="stroke: #000000; stroke-width: 1.0;" width="435" x="47" y="12"/><text fill="#000000" font-family="Consolas" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="419" x="55" y="38.9258">WebRTC发送与接收STUN_Bind_Request</text><ellipse cx="246" cy="63.1016" fill="#000000" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FFFFFF" height="637.8887" style="stroke: #BAC0C1; stroke-width: 2.0;" width="429" x="56" y="83.1016"/><path d="M251,83.1016 L251,94.8359 L241,104.8359 L56,104.8359 " fill="none" style="stroke: #BAC0C1; stroke-width: 2.0;"/><text fill="#555555" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="185" x="59" y="98.7188">发送STUN_Bind_Request</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="300" x="96" y="121.8359"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="280" x="106" y="148.2803">UDPPort::OnLocalAddressReady</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="360" x="66" y="182.9121"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="340" x="76" y="209.3564">UDPPort::MaybePrepareStunCandidate</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="330" x="81" y="243.9883"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="310" x="91" y="270.4326">UDPPort::SendStunBindingRequest</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="330" x="81" y="305.0645"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="310" x="91" y="331.5088">StunRequestManager::SendDelayed</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="240" x="126" y="394.875"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="220" x="136" y="421.3193">StunRequest::OnMessage</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="230" x="131" y="484.6855"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="210" x="141" y="511.1299">UDPPort::OnSendPacket</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="240" x="126" y="545.7617"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="220" x="136" y="572.2061">AsyncUDPSocket::SendTo</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="240" x="126" y="606.8379"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="220" x="136" y="633.2822">PhysicalSocket::SendTo</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="194" x="149" y="667.9141"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="174" x="159" y="694.3584">系统Socket的SendTo</text><ellipse cx="246" cy="750.9902" fill="#FFFFFF" rx="10" ry="10" style="stroke: #66696B; stroke-width: 2.0;"/><path d="M250.1582,751.8682 L246.7041,751.8682 L246.7041,755.4541 L245.1924,755.4541 L245.1924,751.8682 L241.7383,751.8682 L241.7383,750.5322 L245.1924,750.5322 L245.1924,746.9727 L246.7041,746.9727 L246.7041,750.5322 L250.1582,750.5322 Z "/><rect fill="#FFFFFF" height="975.6113" style="stroke: #BAC0C1; stroke-width: 2.0;" width="510" x="11" y="770.9902"/><path d="M206,770.9902 L206,782.7246 L196,792.7246 L11,792.7246 " fill="none" style="stroke: #BAC0C1; stroke-width: 2.0;"/><text fill="#555555" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="185" x="14" y="786.6074">接收STUN_Bind_Request</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="280" x="106" y="809.7246"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="260" x="116" y="836.1689">PhysicalSocketServer::Wait</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="340" x="76" y="870.8008"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="320" x="86" y="897.2451">PhysicalSocketServer::WaitSelect</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="150" x="171" y="931.877"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="130" x="181" y="958.3213">ProcessEvents</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="300" x="96" y="992.9531"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="280" x="106" y="1019.3975">SocketDispatcher::OnPreEvent</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="270" x="111" y="1054.0293"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="250" x="121" y="1080.4736">SocketDispatcher::OnEvent</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="290" x="101" y="1115.1055"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="270" x="111" y="1141.5498">AsyncUDPSocket::OnReadEvent</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="340" x="76" y="1176.1816"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="320" x="86" y="1202.626">AllocationSequence::OnReadPacket</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="310" x="91" y="1237.2578"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="290" x="101" y="1263.7021">UDPPort::HandleIncomingPacket</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="230" x="131" y="1298.334"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="210" x="141" y="1324.7783">UDPPort::OnReadPacket</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="350" x="71" y="1359.4102"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="330" x="81" y="1385.8545">StunRequestManager::CheckResponse</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="320" x="86" y="1420.4863"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="300" x="96" y="1446.9307">StunBindingRequest::OnResponse</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="400" x="46" y="1481.5625"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="380" x="56" y="1508.0068">UDPPort::OnStunBindingRequestSucceeded</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="180" x="156" y="1542.6387"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="160" x="166" y="1569.083">Port::AddAddress</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="270" x="111" y="1603.7148"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="250" x="121" y="1630.1592">Port::FinishAddingAddress</text><rect fill="#FFFFFF" height="41.0762" style="stroke: #66696B; stroke-width: 2.0;" width="450" x="21" y="1693.5254"/><text fill="#000000" font-family="Consolas" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="430" x="31" y="1719.9697">BasicPortAllocatorSession::OnCandidateReady</text><ellipse cx="246" cy="1777.6016" fill="#FFFFFF" rx="11" ry="11" style="stroke: #FF0000; stroke-width: 1.0;"/><ellipse cx="246" cy="1777.6016" fill="#FF0000" rx="6" ry="6" style="stroke: #FF7F7F; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="162.9121" y2="182.9121"/><polygon fill="#66696B" points="242,172.9121,246,182.9121,250,172.9121,246,176.9121" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="223.9883" y2="243.9883"/><polygon fill="#66696B" points="242,233.9883,246,243.9883,250,233.9883,246,237.9883" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="285.0645" y2="305.0645"/><polygon fill="#66696B" points="242,295.0645,246,305.0645,250,295.0645,246,299.0645" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5; stroke-dasharray: 1.0,3.0;" x1="246" x2="246" y1="346.1406" y2="394.875"/><polygon fill="#66696B" points="242,384.875,246,394.875,250,384.875,246,388.875" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="144" x="250" y="373.375">发送请求，接收消息</text><line style="stroke: #66696B; stroke-width: 1.5; stroke-dasharray: 7.0,7.0;" x1="246" x2="246" y1="435.9512" y2="484.6855"/><polygon fill="#66696B" points="242,474.6855,246,484.6855,250,474.6855,246,478.6855" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="225" x="250" y="463.1855">(sigslot)SignalSendPacket</text><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="525.7617" y2="545.7617"/><polygon fill="#66696B" points="242,535.7617,246,545.7617,250,535.7617,246,539.7617" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="586.8379" y2="606.8379"/><polygon fill="#66696B" points="242,596.8379,246,606.8379,250,596.8379,246,600.8379" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="647.9141" y2="667.9141"/><polygon fill="#66696B" points="242,657.9141,246,667.9141,250,657.9141,246,661.9141" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="73.1016" y2="121.8359"/><polygon fill="#66696B" points="242,111.8359,246,121.8359,250,111.8359,246,115.8359" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="708.9902" y2="740.9902"/><polygon fill="#66696B" points="242,730.9902,246,740.9902,250,730.9902,246,734.9902" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="850.8008" y2="870.8008"/><polygon fill="#66696B" points="242,860.8008,246,870.8008,250,860.8008,246,864.8008" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="911.877" y2="931.877"/><polygon fill="#66696B" points="242,921.877,246,931.877,250,921.877,246,925.877" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="972.9531" y2="992.9531"/><polygon fill="#66696B" points="242,982.9531,246,992.9531,250,982.9531,246,986.9531" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="1034.0293" y2="1054.0293"/><polygon fill="#66696B" points="242,1044.0293,246,1054.0293,250,1044.0293,246,1048.0293" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="1095.1055" y2="1115.1055"/><polygon fill="#66696B" points="242,1105.1055,246,1115.1055,250,1105.1055,246,1109.1055" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="1156.1816" y2="1176.1816"/><polygon fill="#66696B" points="242,1166.1816,246,1176.1816,250,1166.1816,246,1170.1816" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="1217.2578" y2="1237.2578"/><polygon fill="#66696B" points="242,1227.2578,246,1237.2578,250,1227.2578,246,1231.2578" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="1278.334" y2="1298.334"/><polygon fill="#66696B" points="242,1288.334,246,1298.334,250,1288.334,246,1292.334" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="1339.4102" y2="1359.4102"/><polygon fill="#66696B" points="242,1349.4102,246,1359.4102,250,1349.4102,246,1353.4102" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="1400.4863" y2="1420.4863"/><polygon fill="#66696B" points="242,1410.4863,246,1420.4863,250,1410.4863,246,1414.4863" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="1461.5625" y2="1481.5625"/><polygon fill="#66696B" points="242,1471.5625,246,1481.5625,250,1471.5625,246,1475.5625" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="1522.6387" y2="1542.6387"/><polygon fill="#66696B" points="242,1532.6387,246,1542.6387,250,1532.6387,246,1536.6387" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="1583.7148" y2="1603.7148"/><polygon fill="#66696B" points="242,1593.7148,246,1603.7148,250,1593.7148,246,1597.7148" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5; stroke-dasharray: 7.0,7.0;" x1="246" x2="246" y1="1644.791" y2="1693.5254"/><polygon fill="#66696B" points="242,1683.5254,246,1693.5254,250,1683.5254,246,1687.5254" style="stroke: #66696B; stroke-width: 1.0;"/><text fill="#000000" font-family="Consolas" font-size="16" lengthAdjust="spacingAndGlyphs" textLength="261" x="250" y="1672.0254">(sigslot)SignalCandidateReady</text><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="760.9902" y2="809.7246"/><polygon fill="#66696B" points="242,799.7246,246,809.7246,250,799.7246,246,803.7246" style="stroke: #66696B; stroke-width: 1.0;"/><line style="stroke: #66696B; stroke-width: 1.5;" x1="246" x2="246" y1="1734.6016" y2="1766.6016"/><polygon fill="#66696B" points="242,1756.6016,246,1766.6016,250,1756.6016,246,1760.6016" style="stroke: #66696B; stroke-width: 1.0;"/><!--MD5=[29540bdae43ab689128704d1f214847d]
@startuml

' https://plantuml-documentation.readthedocs.io/en/latest/formatting/all-skin-params.html

' skinparam monochrome true
' skinparam backgroundColor transparent
' skinparam handwritten true
'/'
skinparam DefaultFontName Consolas
' skinparam DefaultTextAlignment center
skinparam DefaultFontSize 16
skinparam shadowing false

skinparam Activity {
    StartColor black
    EndColor red
    ArrowColor #66696b
    BorderColor #66696b

    BackgroundColor #FFFFFF
    BorderThickness 2
    FontName Consolas
    FontSize 18
    ' FontStyle bold
}

skinparam Note {
    BorderColor #66696b
    BackgroundColor #FFFFFF
    FontName Consolas
    FontSize 16
    FontColor #555555
    ' BorderThickness 4
}

skinparam Partition {
    BorderColor #bac0c1
    FontColor #555555
}

skinparam title {
   FontSize 24
   BorderRoundCorner 10
   BorderThickness 1
   ' BorderColor red
   ' BackgroundColor Aqua-CadetBlue
}
'/

title WebRTC发送与接收STUN_Bind_Request

start

partition 发送STUN_Bind_Request {

:UDPPort::OnLocalAddressReady]

:UDPPort::MaybePrepareStunCandidate]

:UDPPort::SendStunBindingRequest]

:StunRequestManager::SendDelayed]

-[dotted]->发送请求，接收消息;

:StunRequest::OnMessage]

-[dashed]->(sigslot)SignalSendPacket;

:UDPPort::OnSendPacket]

:AsyncUDPSocket::SendTo]

:PhysicalSocket::SendTo]

:系统Socket的SendTo]

}

(+)

partition 接收STUN_Bind_Request {

:PhysicalSocketServer::Wait]

:PhysicalSocketServer::WaitSelect]

:ProcessEvents]

:SocketDispatcher::OnPreEvent]

:SocketDispatcher::OnEvent]

:AsyncUDPSocket::OnReadEvent]

:AllocationSequence::OnReadPacket]

:UDPPort::HandleIncomingPacket]

:UDPPort::OnReadPacket]

:StunRequestManager::CheckResponse]

:StunBindingRequest::OnResponse]

:UDPPort::OnStunBindingRequestSucceeded]

:Port::AddAddress]

:Port::FinishAddingAddress]

-[dashed]->(sigslot)SignalCandidateReady;

:BasicPortAllocatorSession::OnCandidateReady]

}

stop

 
@enduml

@startuml


skinparam DefaultFontName Consolas
skinparam DefaultFontSize 16
skinparam shadowing false

skinparam Activity {
    StartColor black
    EndColor red
    ArrowColor #66696b
    BorderColor #66696b

    BackgroundColor #FFFFFF
    BorderThickness 2
    FontName Consolas
    FontSize 18
}

skinparam Note {
    BorderColor #66696b
    BackgroundColor #FFFFFF
    FontName Consolas
    FontSize 16
    FontColor #555555
}

skinparam Partition {
    BorderColor #bac0c1
    FontColor #555555
}

skinparam title {
   FontSize 24
   BorderRoundCorner 10
   BorderThickness 1
}

title WebRTC发送与接收STUN_Bind_Request

start

partition 发送STUN_Bind_Request {

:UDPPort::OnLocalAddressReady]

:UDPPort::MaybePrepareStunCandidate]

:UDPPort::SendStunBindingRequest]

:StunRequestManager::SendDelayed]

-[dotted]->发送请求，接收消息;

:StunRequest::OnMessage]

-[dashed]->(sigslot)SignalSendPacket;

:UDPPort::OnSendPacket]

:AsyncUDPSocket::SendTo]

:PhysicalSocket::SendTo]

:系统Socket的SendTo]

}

(+)

partition 接收STUN_Bind_Request {

:PhysicalSocketServer::Wait]

:PhysicalSocketServer::WaitSelect]

:ProcessEvents]

:SocketDispatcher::OnPreEvent]

:SocketDispatcher::OnEvent]

:AsyncUDPSocket::OnReadEvent]

:AllocationSequence::OnReadPacket]

:UDPPort::HandleIncomingPacket]

:UDPPort::OnReadPacket]

:StunRequestManager::CheckResponse]

:StunBindingRequest::OnResponse]

:UDPPort::OnStunBindingRequestSucceeded]

:Port::AddAddress]

:Port::FinishAddingAddress]

-[dashed]->(sigslot)SignalCandidateReady;

:BasicPortAllocatorSession::OnCandidateReady]

}

stop

 
@enduml

PlantUML version 1.2020.18(Thu Oct 01 03:40:44 CST 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg>